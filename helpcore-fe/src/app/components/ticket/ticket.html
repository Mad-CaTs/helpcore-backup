<div class="ticket-card">
  <div class="form-header">
    <h1 class="form-title">Abrir un nuevo Ticket</h1>
    <p class="form-subtitle">Por favor, complete el siguiente formulario para crear un nuevo ticket.</p>
  </div>

  <!-- üîπ Vinculado al formGroup -->
  <form id="ticketForm" [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
    <div class="section-title">Informaci√≥n de Contacto</div>

    <div class="form-row">
      <div class="form-group">
        <label for="nombres">Nombres <span class="required">*</span></label>
        <input type="text" id="nombres" class="form-input" placeholder="Ingrese sus nombres" formControlName="nombres">
      </div>

      <div class="form-group">
        <label for="apellidos">Apellidos <span class="required">*</span></label>
        <input type="text" id="apellidos" class="form-input" placeholder="Ingrese sus apellidos"
          formControlName="apellidos">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="dni">DNI <span class="required">*</span></label>
        <input type="text" id="dni" class="form-input" placeholder="12345678" formControlName="dni">
      </div>

      <div class="form-group">
        <label for="telefono">Tel√©fono M√≥vil <span class="required">*</span></label>
        <input type="tel" id="telefono" class="form-input" placeholder="+51 999 999 999" formControlName="telefono">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="codigoAlumno">C√≥digo de Alumno <span class="required">*</span></label>
        <input type="text" id="codigoAlumno" class="form-input" placeholder="A12345678" formControlName="codigoAlumno">
      </div>

      <div class="form-group">
        <label for="sede">Sede <span class="required">*</span></label>
        <select id="sede" class="form-select" formControlName="sede">
          <option value="">‚Äî Seleccionar ‚Äî</option>
          <option value="lima">Lima</option>
          <option value="arequipa">Arequipa</option>
          <option value="trujillo">Trujillo</option>
          <option value="chiclayo">Chiclayo</option>
          <option value="piura">Piura</option>
          <option value="cusco">Cusco</option>
          <option value="huancayo">Huancayo</option>
          <option value="iquitos">Iquitos</option>
        </select>
      </div>
    </div>

    <!-- üîπ Email + bot√≥n -->
    <div class="form-group">
      <label for="email">Correo electr√≥nico activo <span class="required">*</span></label>
      <div class="email-row">
        <input type="email" id="email" class="form-input" placeholder="ejemplo@correo.com" formControlName="email">
        <button type="button" class="btn btn-secondary" (click)="enviarCodigo()"
          [disabled]="!ticketForm.get('email')?.valid">
          Enviar c√≥digo
        </button>
      </div>
      <small *ngIf="mostrarCodigo" style="color:#007bff; cursor:pointer;" (click)="permitirEditarCorreo()">
        ¬øTe equivocaste de correo?
      </small>
    </div>

    <div class="form-group" *ngIf="mostrarCodigo">
      <label for="codigoValidacion">C√≥digo de validaci√≥n</label>
      <div class="email-row">
        <input type="text" id="codigoValidacion" class="form-input" maxlength="6" placeholder="Ingresa el c√≥digo recibido" 
          formControlName="codigoValidacion">
        <button type="button" class="btn btn-secondary" (click)="validarCodigo()"
          [disabled]="!ticketForm.get('codigoValidacion')?.valid || correoVerificado">
          Validar c√≥digo
        </button>
      </div>
      <small *ngIf="ticketForm.get('codigoValidacion')?.invalid && ticketForm.get('codigoValidacion')?.touched"
        style="color:red;">
        El c√≥digo debe tener 6 d√≠gitos num√©ricos
      </small>
    </div>

    <div class="section-title">Temas de ayuda</div>

    <div class="form-group full-width">
      <label for="categoria">Seleccione un tema de ayuda <span class="required">*</span></label>
      <select id="categoria" class="form-select" formControlName="categoria">
        <option value="">‚Äî Seleccione un tema de ayuda ‚Äî</option>
        <option *ngFor="let categoria of categoriaTickets" [value]="categoria.id">
          {{ categoria.nombre }}
        </option>
      </select>

      <small *ngIf="categoriaTickets.length === 0 && !isLoading" class="text-danger">
        No hay categor√≠as disponibles
      </small>

      <small *ngIf="isLoading" class="text-muted">
        Cargando categor√≠as...
      </small>
    </div>

    <!-- üîπ Campos din√°micos: aparecen cuando hay un tema de ayuda -->
    <div *ngIf="ticketForm.get('categoria')?.value" class="form-group full-width">
      <label for="asunto">Asunto <span class="required">*</span></label>
      <input type="text" id="asunto" class="form-input" placeholder="Ingrese el asunto" formControlName="asunto">
    </div>

    <div *ngIf="ticketForm.get('categoria')?.value" class="form-group full-width">
      <label for="comentarios">Comentarios / Detalles <span class="required">*</span></label>
      <textarea id="comentarios" class="form-input" rows="5" placeholder="Escriba aqu√≠ los detalles de su consulta"
        formControlName="comentarios"></textarea>
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary" id="createBtn">
        Crear Ticket
      </button>
      <button type="reset" class="btn btn-secondary" id="resetBtn" (click)="onReset()">
        Restablecer
      </button>
      <button type="button" class="btn btn-outline" id="cancelBtn" (click)="onCancel()">
        Cancelar
      </button>
    </div>
  </form>
</div>