<div class="dashboard-container">
  <div class="dashboard-header">
    <h1 class="dashboard-title">Dashboard de Tickets</h1>
    <p class="dashboard-subtitle">Gestiona y da seguimiento a los tickets asignados</p>
  </div>

  <div class="search-toolbar">
    <div class="search-section">
      <div class="search-input-wrapper">
        <i class="bi bi-search search-icon"></i>
        <input 
          type="text" 
          class="search-input"
          placeholder="Título, código, invitado, categoría, etc"
          [(ngModel)]="busqueda"
          (input)="buscarTickets()">
        <button 
          *ngIf="busqueda" 
          class="btn-clear-input" 
          (click)="limpiarBusqueda()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="filter-select-wrapper">
        <i class="bi bi-funnel filter-icon"></i>
        <select 
          class="filter-select"
          [(ngModel)]="filtroPrioridad"
          (change)="filtrarPorPrioridad(filtroPrioridad)">
          <option value="TODAS">Todas las prioridades</option>
          <option value="URGENTE">🔴 URGENTE</option>
          <option value="ALTA">🟠 ALTA</option>
          <option value="MEDIA">🟡 MEDIA</option>
          <option value="BAJA">🟢 BAJA</option>
        </select>
      </div>
    </div>

    <button 
      class="btn-refresh-icon" 
      (click)="cargarTickets()" 
      [disabled]="isLoading"
      title="Refrescar tickets">
      <i class="bi bi-arrow-clockwise" [class.spinning]="isLoading"></i>
    </button>
  </div>

  <div class="active-filters" *ngIf="busqueda || filtroPrioridad !== 'TODAS' || filtroEstado !== 'TODOS'">
    <span class="filters-label">Filtros activos:</span>
    
    <span class="filter-tag" *ngIf="busqueda">
      <i class="bi bi-search"></i> "{{ busqueda }}"
      <button class="remove-filter" (click)="busqueda = ''; aplicarFiltros()">
        <i class="bi bi-x"></i>
      </button>
    </span>

    <span class="filter-tag" *ngIf="filtroEstado !== 'TODOS'">
      <i class="bi bi-flag"></i> {{ filtroEstado.replace('_', ' ') }}
      <button class="remove-filter" (click)="filtrarPorEstado('TODOS')">
        <i class="bi bi-x"></i>
      </button>
    </span>

    <span class="filter-tag" *ngIf="filtroPrioridad !== 'TODAS'">
      <i class="bi bi-exclamation-circle"></i> {{ filtroPrioridad }}
      <button class="remove-filter" (click)="filtrarPorPrioridad('TODAS')">
        <i class="bi bi-x"></i>
      </button>
    </span>

    <button class="btn-clear-all-filters" (click)="limpiarTodosLosFiltros()">
      Limpiar todo
    </button>
  </div>

  <div class="results-info" *ngIf="!isLoading">
    Mostrando <strong>{{ ticketsFiltrados.length }}</strong> de <strong>{{ tickets.length }}</strong> tickets
    <span *ngIf="busqueda" class="search-term">
      · Búsqueda: "{{ busqueda }}"
    </span>
  </div>

  <!-- Filtros y estadísticas -->
  <div class="stats-grid">
    <div class="stat-card" [class.active]="filtroEstado === 'TODOS'" (click)="filtrarPorEstado('TODOS')">
      <div class="stat-icon">
        <i class="bi bi-ticket-perforated"></i>
      </div>
      <div class="stat-content">
        <h3>{{ tickets.length }}</h3>
        <p>Total Tickets</p>
      </div>
    </div>

    <div class="stat-card" [class.active]="filtroEstado === 'NUEVO'" (click)="filtrarPorEstado('NUEVO')">
      <div class="stat-icon nuevo">
        <i class="bi bi-plus-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ contarPorEstado('NUEVO') }}</h3>
        <p>Nuevos</p>
      </div>
    </div>

    <div class="stat-card" [class.active]="filtroEstado === 'EN_ATENCION'" (click)="filtrarPorEstado('EN_ATENCION')">
      <div class="stat-icon en-atencion">
        <i class="bi bi-clock-history"></i>
      </div>
      <div class="stat-content">
        <h3>{{ contarPorEstado('EN_ATENCION') }}</h3>
        <p>En Atención</p>
      </div>
    </div>

    <div class="stat-card" [class.active]="filtroEstado === 'RESUELTO'" (click)="filtrarPorEstado('RESUELTO')">
      <div class="stat-icon resuelto">
        <i class="bi bi-check-circle"></i>
      </div>
      <div class="stat-content">
        <h3>{{ contarPorEstado('RESUELTO') }}</h3>
        <p>Resueltos</p>
      </div>
    </div>
  </div>

  <!-- Tabla de tickets -->
  <div class="tickets-table-container">
    <div *ngIf="isLoading" class="loading-state">
      <i class="bi bi-hourglass-split"></i>
      <p>Cargando tickets...</p>
    </div>

    <div *ngIf="!isLoading && ticketsFiltrados.length === 0" class="empty-state">
      <i class="bi bi-inbox"></i>
      <p>No hay tickets para mostrar</p>
    </div>

    <table *ngIf="!isLoading && ticketsFiltrados.length > 0" class="tickets-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Título</th>
          <th>Estado</th>
          <th>Prioridad</th>
          <th>Solicitante</th>
          <th>Categoría</th>
          <th>Sede</th>
          <th>Creado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ticket of ticketsFiltrados">
          <td class="ticket-id">#{{ ticket.id }}</td>
          <td class="ticket-titulo">{{ ticket.titulo }}</td>
          <td>
            <span class="badge" [ngClass]="getEstadoBadgeClass(ticket.estado)">
              {{ ticket.estado.replace('_', ' ') }}
            </span>
          </td>
          <td>
            <span class="badge" [ngClass]="getPrioridadBadgeClass(ticket.prioridad)">
              {{ ticket.prioridad }}
            </span>
          </td>
          <td class="ticket-solicitante">
            {{ ticket.invitado.nombre }} {{ ticket.invitado.apellido }}
          </td>
          <td class="ticket-categoria">{{ ticket.categoria.nombre }}</td>
          <td class="ticket-sede">{{ ticket.sede }}</td>
          <td class="ticket-fecha">{{ ticket.fechaCreacion | date:'dd/MM/yyyy' }}</td>
          <td class="ticket-acciones">
            <button class="btn-action btn-primary" title="Ver detalle">
              <i class="bi bi-eye"></i>
            </button>           
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>